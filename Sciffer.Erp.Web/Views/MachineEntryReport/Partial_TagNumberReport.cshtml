@using Sciffer.Erp.Domain.ViewModel
@using Syncfusion.JavaScript.Models

@{
(Html.EJ().Grid<mfg_machine_task_VM>("Editing")
.Datasource((IEnumerable<object>)ViewBag.datasource)
.AllowPaging().PageSettings(a => a.PageSize(20))
.AllowFiltering()
.FilterSettings(X => X.FilterType(FilterType.Excel))
.ShowColumnChooser()
.AllowSorting()
.AllowScrolling()
.Mappers(map => map.ExportToExcelAction(Url.Action("ExportToExcel", "MachineEntryReport", new { ctrlname = "MachineEntryReport" })))
.ScrollSettings(scroll => { scroll.Width("100%"); })

.ToolbarSettings(toolbar =>
{
    toolbar.ShowToolbar().ToolbarItems(items =>
    {
        items.AddTool(ToolBarItems.Search);
        items.AddTool(ToolBarItems.ExcelExport);
        items.AddTool(ToolBarItems.PrintGrid);
    });
})

.Columns(col =>
{
    col.Field("tag_no").Width("10%").HeaderText("Tag Number").Add();
    col.Field("item_batch_no").Visible(false).Width("10%").HeaderText("Batch").Add();
    col.Field("prod_order_no").Visible(false).Width("10%").HeaderText("Production Order").Add();
    col.Field("in_item_desc").Visible(false).Width("10%").HeaderText("Item Name").Add();
    col.Field("machine_name").Width("10%").HeaderText("Machine Name").Add();
    col.Field("status_name").Width("10%").HeaderText("Status").Add();
    col.Field("operator_name").Width("10%").HeaderText("Operator Name").Add();
    col.Field("task_time").Width("10%").HeaderText("Task Time").Add();

})
.ClientSideEvents(eve => { eve.ToolbarClick("OnToolbarClick"); })
)
.Render();
}
@Html.EJ().ScriptManager()
<br />

<script type="text/javascript">

    function OnToolbarClick(args) {
        if (args.itemName.indexOf("Export") > -1) {

            if ($('#ITEM_ID :selected').length > 0) {
                var selectedItem = [];
                $('#ITEM_ID :selected').each(function (i, selected) {
                    selectedItem[i] = $(selected).val();
                });
                var ItemList = selectedItem + "";
            }

            if ($('#prod_order_id :selected').length > 0) {
                var selectedProdOrder = [];
                $('#prod_order_id :selected').each(function (i, selected) {
                    selectedProdOrder[i] = $(selected).val();
                });
                var ProdOrderList = selectedProdOrder + "";
            }

            this.model["fromDate"] = $("#fromDate").val();
            this.model["toDate"] = $("#toDate").val();
            this.model["tag_number"] = $("#tag_number").val();
            this.model["ITEM_ID"] = ItemList;
            this.model["prod_order_id"] = ProdOrderList;
            this.model["machine_task_status_id"] = $("#machine_task_status_id").val();
        }
    }

</script>


