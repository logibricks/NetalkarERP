@{
    ViewBag.Title = "Index";
}

<h2>Role Rights <small></small></h2>
<hr />
@using (Html.BeginForm("UpdateRecords", "UserRoleRights", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div id="rights_id"></div>
    <div class="row">
        <div class="clearfix"></div>
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="form">
                <div class="area">
                    <div class="row">
                        <div class="col-md-6">

                            <div class="col-md-8">
                                @Html.DropDownList("role_id", (new System.Web.Mvc.SelectList(ViewBag.rolelist, "role_id", "role_name")), "--select--", htmlAttributes: new { @class = "form-control item", required = "required" })
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg12 col-sm-12">
                            <div class="form-group">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <input type="submit" id="updateData" class="btn btn-primary" value="Update" onclick="TableToJson()" style="float:right;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr />
                <div class="container">
                    <div class="inputs">
                        <input type="hidden" id="process">
                        <div id="machine_append">
                            <table id="OrderGrid" class="table table-striped table-bordered" style="font-size:14px;">
                                <thead>
                                    <tr>
                                        <th><label>Sr No.</label></th>
                                        <th><label>Form Id</label></th>
                                        <th><label>Form</label></th>
                                        <th><label>Create</label></th>
                                        <th><label>Edit</label></th>
                                        <th><label>View</label></th>
                                    </tr>
                                </thead>
                                <tbody id="tablegrid"></tbody>
                            </table>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">
        $(document).ready(function () {

            if ('@ViewBag.msg' == "saved") {
                window.location.href = '@Url.Action("Index", "UserRoleRights")'
                swal("Record saved");
            }
            else if('@ViewBag.msg' == "failed"){
                swal("Something went wrong!");
            }
            else{}


            $("#role_id").select2({
                placeholder: "Select Role",
                allowClear: true
            });

        });

        $("#role_id").change(function () {

            var role_id = $("#role_id").val();
            $.ajax({
                url: "@Url.Action("GetAllFromModules", "UserRoleRights")",
                method: "POST",
                cache: false,
                data: { role_id: role_id },
                success: function (data) {
                    //var t = $('#OrderGrid').dataTable();
                    //t.fnClearTable();
                    $("#tablegrid").empty();
                    var count = 0;
                    for (var i = 0; i < data.length; i++) {
                        count++;
                        $("#tablegrid").append(
                            '<tr>' +
                                '<td>' +
                                    count +
                                '</td>' +
                                '<td>' +
                                    data[i].module_form_id +
                                '</td>' +

                                '<td>' +
                                    '<label>' + data[i].module_form_name + '</label>' +
                                '</td>' +
                                '<td>' +
                                    '<input type="checkbox" id="create' + i + '">' +
                                '</td>' +
                                '<td>' +
                                    '<input type="checkbox" id="edit' + i + '">' +
                                '</td>' +
                                '<td>' +
                                    '<input type="checkbox" id="view' + i + '">' +
                                '</td>' +
                            '</tr>')

                        if (data[i].create_rights == true) {
                            document.getElementById("create" + i).setAttribute('checked', 'checked');
                        }
                        else {
                            document.getElementById("create" + i).removeAttribute('checked');
                        }

                        if (data[i].edit_rights == true) {
                            document.getElementById("edit" + i).setAttribute('checked', 'checked');
                        }
                        else {
                            document.getElementById("edit" + i).removeAttribute('checked');
                        }

                        if (data[i].view_rights == true) {
                            document.getElementById("view" + i).setAttribute('checked', 'checked');
                        }
                        else {
                            document.getElementById("view" + i).removeAttribute('checked');
                        }
                    }
                }
            })
        })

        function TableToJson() {
            $('#OrderGrid').DataTable({
                "bPaginate": false,
                "ordering": false,
                "bfooter": false,
                "info": false,
                "bLengthChange": false,
                "bAutoWidth": false,
                "bFilter": false,
                "bSort": false,

            });

            var t = $('#OrderGrid').dataTable();

            var rowCount1 = t.fnGetData().length;

            for (i = 0; i < rowCount1; i++) {

                $("#rights_id").append('<input type="hidden" id="form_id_name' + i + '" name="form_id_name">');
                $("#rights_id").append('<input type="hidden" id="create_rights_name' + i + '" name="create_rights_name">');
                $("#rights_id").append('<input type="hidden" id="edit_rights_name' + i + '" name="edit_rights_name">');
                $("#rights_id").append('<input type="hidden" id="view_rights_name' + i + '" name="view_rights_name">');

                $("#form_id_name" + i).val(t.fnGetData(i)[1]);
                //$("#create_rights_name" + i).val(t.fnGetData(i)[2]);
                //$("#edit_rights_name" + i).val(t.fnGetData(i)[3]);
                //$("#view_rights_name" + i).val(t.fnGetData(i)[4]);


                if ($('#create' + i).is(':checked')) {
                    // the checkbox is now checked
                    $("#create_rights_name" + i).val(true);
                } else {
                    // the checkbox is now no longer checked
                    $("#create_rights_name" + i).val(false);
                }

                if ($('#edit' + i).is(':checked')) {
                    // the checkbox is now checked
                    $("#edit_rights_name" + i).val(true);
                } else {
                    // the checkbox is now no longer checked
                    $("#edit_rights_name" + i).val(false);
                }

                if ($('#view' + i).is(':checked')) {
                    // the checkbox is now checked
                    $("#view_rights_name" + i).val(true);
                } else {
                    // the checkbox is now no longer checked
                    $("#view_rights_name" + i).val(false);
                }

            }
        }

        $("#createorder").click(function () {
            var role = $("#role_id").val();

            console.log(role);
            @*$.ajax({
            url: '@Url.Action("CreateOrder", "UserRoleRights")',
            type: "POST",
            cache: false,
            data: { role_id: role_id},
            success: function (data) {
                if (data == 1) {
                    swal("Order Saved..!!", "Order Has been successfully Saved..!!", "success");
                    setTimeout(function () {
                        location.reload();
                    }, 2000);
                }
                else {
                    swal("Not Saved..!!", "Something went wrong..!!", "error");
                    // alert("Order Not Placed");
                }
            }
        });*@


        });
    </script>
}